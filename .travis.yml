sudo: required
language: node_js
node_js: "8"

install: skip
script: skip

jobs:
  include:
    - stage: Tests
      script: echo "No tests at the moment"
    - stage: Build and push Docker images
      services:
        - docker
      before_install:
        - docker build -t tomochain/tomochain-explorer-server -f Dockerfile.server .
        - docker build -t tomochain/tomochain-explorer-client -f Dockerfile.client .
      deploy:
        provider: script
        script: bash docker_push.sh
        on:
          branch: master
    - stage: Trigger rebuild of infrastructure images
      sudo: false
      script: bash docker_rebuild.sh

stages:
  - name: Build and push Docker images
    if: type != pull_request AND branch = master
  - name: Trigger rebuild of infrastructure images
    if: type != pull_request AND branch = master

notifications:
  slack:
    rooms:
      secure: DoWVSWEKZre0rsYvHPqOBpYa5hL7DagVCP7eGR+2dluzsyUOTW58uiaezaZMAPPG6k7i1TC9CufONkFRwH6kqLrFtAFd+t3sKb3X4D9/PSa9k88uBuNfsX+JhUzEMT53pfLO9NTBbZs3M6bOuZDP7GddWWnMZpO6Mu7RzZtVxyqbZIcNu3nxsmLkoaQ8726npaHrxhO1Ab+3rgR4dkNFLgl9/CnPwvuv/j24dsKzly6tF+4Ms9Fz5O0Te8zK5d/UWZN50e+uDnbzcIvbY2VHOYXchXZRbfKO8/M2TIXLPKbLc3alCw1ZvpFZqiMYK3SnGNby4FLp8RlC6H4sv52YeNq3fHH8SgOJ3xTL8m6ejIlqoKnUNsJ1lwtfiEVu5D1b8FRKTPqoh+cjadJxsF9dO0xZsf1d5Pmq6Ncr0j6di1ZMjCc6TPFERxkdA48+PzQY4TqfBpM4E5RnJuX9O9MJFbA1fZo2xhHcy0LlkslZMpSwiv/YO4bCJZPmxvHtruqELJXxjYyC67UbzSzrBVE1g1bXy0V5xyxPIEA38jzlNczhq6fg2gyEc+6JCbzN2gFoAS5uFWQHpUhXHc7zNB5Jyi7GPQv6cfHYcedjn9In9/bNDqqGexGX4Ih/cb6W1GOHC7c2A/AsfTa9KWmsyj7YwBRXFIXfme7bBh6VGuRqU3Y=
    on_success: change
    on_failure: always
